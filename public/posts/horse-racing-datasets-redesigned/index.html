<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>CMS Test</title>
</head>
<body>
  
  <article>
    <h1>Horse Racing Datasets redesigned</h1>
    <p>Finally! It took a while to <a href="https://twitter.com/superterrific/status/1353047440664915969">circle back to the design</a> after having so much fun <a href="/articles/using-airtable-with-eleventy/">figuring out how to build it</a>, but the fourth version of Horse Racing Datasets is <a href="https://horseracingdatasets.com/">finally done</a>! Or at least out there in a good place with more improvements to come.</p>
<p>At the end of last year I had a working <a href="/notes/update-on-the-end-of-the-year-to-do-list/">proof of concept</a> of how to use <a href="">Airtable</a> with <a href="">Eleventy</a> and wrote <a href="/articles/using-airtable-with-eleventy/">an article</a> detailing all the particulars. At the time I couldn't figure out how to filter on the on the dataset so I did two extra API calls for <a href="https://horseracingdatasets.com/recently-added/">recently added listing</a> and to display a <a href="https://horseracingdatasets.com/">random dataset on the homepage</a>. As I mentioned in my <a href="/notes/ugging-along/">last update</a> I have since figured out how to do it all from a single API call, so updating the article goes on the to do list.</p>
<p>I also need to update the <a href="">project page</a>, until then here's a bit about some of the improvements and updates...</p>
<h2>Filtering</h2>
<p>Being able to do everything from a single API call is not only a big improvement from my initial proof of concept for this version, but an incredibly big improvement from the prior version, which used an API call for <strong>each category</strong>. This marks a huge step forward in my problem solving abilities, so rather than be mortified by the last version (OK, I'm still a little mortified!), I'm going to be proud of the improvements I've made over the last two years.</p>
<p>A lot of this will go in the update of the <a href="/articles/using-airtable-with-eleventy/">Airtable and Eleventy article</a>, but here are some particulars on the filtering.</p>
<p>I used the <a href="https://11ty.rocks/eleventyjs/data-arrays/#randomitem-filter">randItem filter from 11ty Rocks</a> to display a &quot;Random Dataset of the Day&quot;. Since Eleventy only pulls from the API on build, I used <a href="">Zapier</a> to schedule a <a href="https://zapier.com/apps/netlify/integrations/schedule/29330/start-deploys-of-netlify-sites-on-a-daily-schedule">daily build at Netlify</a>. This displays a new random dataset and picks up any datasets I've added to Airtable since the last build, making maintenance a snap.</p>
<p>The <a href="https://horseracingdatasets.com/all/">All Datasets</a> page displays alphabetically and the sort order is set at Airtable. But on the <a href="/articles/using-airtable-with-eleventy/#listing-by-tag">category pages</a> the default listing is to display by most recently added. With some search engine luck <a href="https://stackoverflow.com/questions/65471629/dot-notation-in-nunjucks-sorting-isnt-working/65481434#65481434">I found this approach</a> and was able to create a filter to sort by title to keep the same approach used on the All Datasets listing.</p>
<p>The filter gets added in <code>eleventy.js</code>...</p>
<p>The set-up is similar for the <a href="https://horseracingdatasets.com/recently-added/">Recently Added</a> page. The filter gets added in <code>eleventy.js</code>...</p>
<p>I'm also using the <a href="https://11ty.rocks/eleventyjs/data-arrays/#limit-filter">limit filter from 11ty Rocks</a> to set the amount of most recent datasets to return.</p>
<h2>Accessibility improvements</h2>
<p>In the previous version the header was sticky and navigation sidebar was fixed with scrolling on larger screens. Generally I like this sort of layout for documentation or for browsing listings, but there are issues with <a href="https://www.w3.org/WAI/WCAG21/Understanding/reflow.html">screen reflow</a> when zooming out the screen size. The previous version became less usable around 240% zoom.</p>
<p>In the current version everything flows nicely and it's easy to read all the way up to 500%.</p>
<p>Other improvements include visible focus states and color contrast that meets <a href="https://www.w3.org/WAI/WCAG21/Understanding/contrast-minimum.html">WCAG AA standards</a> in both the light and dark mode.</p>
<p>The current set up uses the visitor's system-level settings, but I want to add to add the ability toggle sooner rather than later. I tried to implement the <a href="https://piccalil.li/tutorial/create-a-user-controlled-dark-or-light-mode">Piccalilli user controlled dark or light mode</a> with no luck. I already had the current implementation working by time I tried it, and I'm also using a LOT of custom properties for the themes, but I think my lack of JavaScript skill was the real culprit. Rather than hold up the latest version I decided I'll put this one on the to do list and come back to it.</p>
<h2>Progressive enhancements</h2>
<p>The menu toggle is simple yet progressively enhanced to work when JavaScript is disabled or fails to load. It uses the &quot;no-js&quot; fallback approach, which can <a href="https://twitter.com/piccalilli_/status/1349730273135476741">easily cause accessibility issues</a>. I tested in VoiceOver as well as keyboard-only with JavaScript enabled and disabled and it worked well. My testing was very limited, but hopefully it will work well for everyone.</p>
<p>For a more robust and bulletproof approach Andy Bell has a <a href="https://piccalil.li/premium/build-a-fully-responsive-progressively-enhanced-burger-menu/">great premium tutorial at Piccalilli</a>. The membership <a href="https://twitter.com/piccalilli_/status/1372948942019760132">price recently dropped</a> making it easier to avail yourself of top-notch educational content! I want to improve my JavaScript skills to really understand more about resizeObserver and other more advanced topics before I try my hand at that one. But for now I feel like the site offers a good experience.</p>
<p>Filed under &quot;know thy audience&quot;, when doing any horse racing related project I make sure to do a quick pass in IE11 on my work machine (don't ask!). The core horse racing audience generally skews older and is less likely to keep their devices up to date. Since I use custom properties the site pretty much renders as black and white in IE11. I have shadows on the dataset container and tags, and originally had them directly in their respective class selectors. They looked a bit odd in the &quot;no color&quot; version so I moved them to custom properties to keep them from rendering in IE11. This site basically looks like a <a href="https://duckduckgo.com/?t=ffsb&amp;q=generic+food+label&amp;atb=v225-1&amp;iax=images&amp;ia=images">generic food label</a> in IE, and I have to admit that I kind of like it.</p>
<p>I also took a quick look with Edge on my work machine and was surprised to discover that it was an older version (44). I discovered this because the spacing was off in several areas and I realized that <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/clamp()#browser_compatibility">clamp() was not supported</a> in that version. I should've thought of this level of progressive enhancement before, but it lead me to figure out that defaults can be set in combination with <code>clamp()</code>, which allows unsupported browsers to pick-up the non-clamp property.</p>
<p>In the above example browsers that don't support <code>clamp()</code> use padding: 1rem while the others use <code>clamp()</code>.</p>
<h2>Performance improvements</h2>
<p>Performance improvements are no surprise when going from a site that did an API call on every page to a static site. But it did surprise me that the previous version's performance scores weren't worse, not that they're good, but I imagined much worse.</p>
<table>
<thead>
<tr>
<th style="text-align:left">Performance Metric</th>
<th style="text-align:left">Previous Version</th>
<th style="text-align:left">Current Version</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">First Contentful Paint</td>
<td style="text-align:left">1.5s</td>
<td style="text-align:left">0.8s</td>
</tr>
<tr>
<td style="text-align:left">Speed Index</td>
<td style="text-align:left">1.7s</td>
<td style="text-align:left">0.8s</td>
</tr>
<tr>
<td style="text-align:left">Largest Contentful Paint</td>
<td style="text-align:left">3.2s</td>
<td style="text-align:left">1.7s</td>
</tr>
<tr>
<td style="text-align:left">Time to Interactive</td>
<td style="text-align:left">3.5s</td>
<td style="text-align:left">0.8s</td>
</tr>
<tr>
<td style="text-align:left">Total Blocking Time</td>
<td style="text-align:left">160ms</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">Cumulative Layout Shift</td>
<td style="text-align:left">0.113</td>
<td style="text-align:left">0.01</td>
</tr>
</tbody>
</table>
<p>Another area of performance improvement was moving from Tailwind CSS to handwritten CSS. Tailwind isn't necessarily a performance issue, but I used it as is with no optimization, mostly because I didn't (and arguably still don't!) know how to use build tools.</p>
<p>Here's a comparison using <a href="https://cssstats.com/">CSS Stats</a></p>
<table>
<thead>
<tr>
<th style="text-align:left">CSS Stat</th>
<th style="text-align:left">Previous Version</th>
<th style="text-align:left">Current Version</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">File size</td>
<td style="text-align:left">566kb</td>
<td style="text-align:left">8kb</td>
</tr>
<tr>
<td style="text-align:left">Gzipped file size</td>
<td style="text-align:left">77kb</td>
<td style="text-align:left">2kb</td>
</tr>
<tr>
<td style="text-align:left">Rules</td>
<td style="text-align:left">9,901</td>
<td style="text-align:left">78</td>
</tr>
<tr>
<td style="text-align:left">Selectors</td>
<td style="text-align:left">9,969</td>
<td style="text-align:left">101</td>
</tr>
<tr>
<td style="text-align:left">Declarations</td>
<td style="text-align:left">10,988</td>
<td style="text-align:left">244</td>
</tr>
<tr>
<td style="text-align:left">Properties</td>
<td style="text-align:left">117</td>
<td style="text-align:left">100</td>
</tr>
<tr>
<td style="text-align:left">ID</td>
<td style="text-align:left">2</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">Class</td>
<td style="text-align:left">9,834</td>
<td style="text-align:left">59</td>
</tr>
<tr>
<td style="text-align:left">Pseudo class</td>
<td style="text-align:left">3,837</td>
<td style="text-align:left">19</td>
</tr>
<tr>
<td style="text-align:left">Pseudo element</td>
<td style="text-align:left">12</td>
<td style="text-align:left">5</td>
</tr>
</tbody>
</table>
<p>No surprises that there were drastic reductions, you can also view the <a href="https://cssstats.com/stats?url=https%3A%2F%2Fhorseracingdatasets.com%2Fall%2F">full stats for the All Datasets listing page</a> at CSS Stats.</p>
<h2>Housekeeping</h2>
<p>As mentioned in the <a href="#filtering">Filtering section</a>, I set up daily build at <a href="https://zapier.com/apps/netlify/integrations/schedule/29330/start-deploys-of-netlify-sites-on-a-daily-schedule">Netlify using Zapier</a>. API calls are only made at build time, so this ensures that there will be a new Random Dataset of Day <a href="https://horseracingdatasets.com">on the homepage</a> and that any datasets I've added to Airtable will picked up daily.</p>
<p>I changed a couple of urls from the previous version so I set up redirects for those changes. Netlify offers a couple of different approaches to <a href="https://docs.netlify.com/routing/redirects/">handle redirects</a>. I went with the redirects file. To make sure it ends up in the directory that's deployed I added this to my <code>eleventy.js</code> file...</p>
<p>Finally, I wasn't originally going to have individual pages for each dataset, but I realized this would make it easier to share and reference them. I used this <a href="https://www.11ty.dev/docs/pages-from-data/">handy approach</a> from the Eleventy Docs.</p>
<h2>What's next</h2>
<p>Knocking this one off the list was a big accomplishment, but there's always something else to do. Here's what I'll be focusing on next.</p>
<ul>
<li>Update the <a href="https://danabyerly.com/projects/horse-racing-datasets/">project page</a>.</li>
<li>The 2021 version of <a href="https://danabyerly.com/projects/kentucky-derby-magic-8-ball/">Derby Magic 8 Ball</a>, and maybe a revival of the <a href="http://www.exactamundo.org/2018/04/16/2018-kentucky-derby-random-top-10-generator/">Random Derby Top 10 List</a>.</li>
<li>Update <a href="/articles/using-airtable-with-eleventy/">Using Airtable with Eleventy</a> to include improved approaches.</li>
<li>Work on the visitor-controlled light and dark toggle.</li>
<li>Research adding search to the site.</li>
<li>A secret project with <a href="http://twitter.com/railbird">Jessica Chapel</a>!</li>
</ul>

    <ul>
      
        <li>
          <a href="/tag/accessibility/"><span aria-hidden="true">#</span>accessibility</a>
        </li>
      
        <li>
          <a href="/tag/airtable/"><span aria-hidden="true">#</span>airtable</a>
        </li>
      
        <li>
          <a href="/tag/eleventy/"><span aria-hidden="true">#</span>eleventy</a>
        </li>
      
        <li>
          <a href="/tag/side-projects/"><span aria-hidden="true">#</span>side-projects</a>
        </li>
      
    </ul>
  </article>

</body>
</html>
